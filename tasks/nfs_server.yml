---

- name: Create irida nfs directories
  file:
    path: "{{ item }}"
    state: directory
  with_items:
    - "{{ irida_dir }}"
    - "{{ nfs_root }}"
    - "{{ irida_nfs_dir }}"

- name: Bind mount irida directory to nfs root directory
  lineinfile:
    path: "/etc/fstab"
    line: "{{ irida_dir }} {{ irida_nfs_dir }} none bind 0 0"
    state: present
    insertafter: EOF

- name: Add nfs directories to exports
  lineinfile:
    path: "/etc/exports"
    line: "{{ item }} {{ irida_url }}/24(rw,sync,no_root_squash)"
    state: present
    insertafter: EOF
  with_items:
    - "{{ nfs_root }}"
    - "{{ irida_nfs_dir }}"
  notify: Restart nfs-server

- name: Flush handlers, restart nfs-server
  meta: flush_handlers
